!function o(r,a,u){function d(t,e){if(!a[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var s=a[t]={exports:{}};r[t][0].call(s.exports,function(e){return d(r[t][1][e]||e)},s,s.exports,o,r,a,u)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)d(u[e]);return d}({1:[function(e,t,n){"use strict";var c=e("./constants.js").OFF,i=e("./xhr.js"),a="https:"===document.location.protocol?"https:":"http:",s="TrustboxSplitTest";function o(e,t){var n="domain="+function(){for(var e="weird_get_top_level_domain=cookie",t=document.location.hostname.split("."),n=t.length-1;0<=n;n--){var i=t.slice(n).join(".");if(document.cookie=e+";domain=."+i+";",-1<document.cookie.indexOf(e))return document.cookie=e.split("=")[0]+"=;domain=."+i+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",i}}(),i="expires="+t;return document.cookie=[s+"="+e,"path=/",n,i].join("; "),i}function u(e){var t=void 0;try{t=function(){for(var e=s+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var i=t[n];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(e))return i.substring(e.length,i.length)}}();var n=JSON.parse(decodeURIComponent(t));if(n.businessUnitId===e)return n}catch(e){if(t){var i="domain="+window.location.hostname.replace(/^.*\.([^.]+\.[^.]+)/,"$1");document.cookie=s+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/;"+i}}}function d(e){if(e){if(!e.expiry){e.expiry=new Date((new Date).getTime()+864e7).toUTCString()}return o(encodeURIComponent(JSON.stringify(e)),e.expiry)}}function f(e,t){for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t}t.exports={getABSettingsAsync:function(s,o){var r=u(s);r&&(!r.sessionStart||+new Date<r.sessionStart+18e5)?o(r,r.expiry):i.xhrGet({url:a+"//widget.trustpilot.com/v1/ratios/"+s,success:function(e){var t=function(e,t){if(!e||!e.groups)return null;for(var n=0,i=0,s=[],o=0;o<e.groups.length;o++)"number"==typeof e.groups[o].ratio&&(n+=e.groups[o].ratio,++i,s.push(e.groups[o]));if(0===i)return null;1===i&&n<1&&(s.push({name:c,ratio:1-n}),n=1);for(var r=0,a=Math.random()*n,u=s[0].name,d=[],l=0;l<s.length;l++)r<=a&&a<r+s[l].ratio&&(u=s[l].name),d.push(s[l].name),r+=s[l].ratio;return{allGroups:d,group:u,testId:e.testId,businessUnitId:t,session:f(),sessionStart:+new Date,anonymousId:f()}}(e,s);if(r&&r.testId===t.testId){r.session=f(),r.sessionStart=+new Date;var n=d(r);return o(r,n)}var i=d(t);return o(t,i)},error:function(){o(null)}})}}},{"./constants.js":2,"./xhr.js":8}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.EMPTY_WIDGET_ID="000000000000000000000000",n.OFF="OFF"},{}],3:[function(e,t,n){"use strict";var k=!1;function T(e){try{if(k)return;var t=document.createElement("script");t.setAttribute("type","application/ld+json"),t.innerHTML=JSON.stringify(e),document.head.appendChild(document.createComment("Added by Trustpilot")),document.head.appendChild(t),document.head.appendChild(document.createComment("/Added by Trustpilot")),k=!0}catch(e){}}var E=e("./xhr.js"),x="https:"===document.location.protocol?"https:":"http:";t.exports=function(e){return!(k||(e.schemaType?(m=(p=e).schemaType,g=p.businessunitId,y=p.location,v=p.locale,w=p.templateId,b=["type="+m,"url="+encodeURIComponent(window.location.href),"templateId="+w,"locale="+v].join("&"),I=x+"//widget.trustpilot.com"+(y?"/data/jsonld/business-unit/"+g+"/location/"+y:"/data/jsonld/business-unit/"+g)+"?"+b,E.xhrGet({url:I,success:function(e){e.url=document.location.href,T(e)},error:function(e){console.error(e)}}),0):!e.name||!e.sku||(n=(t=e).businessunitId,i=t.locale,s=t.templateId,o=t.name,r=t.sku,a=t.reviewnumber,u=t.price,d=t.priceCurrency,l=t.availability,c=i&&i.split("-")[0],f=x+"//widget.trustpilot.com"+("5763ba71ba484803e8b222ba"===s||"5763bccae0a06d08e809ecbb"===s?"/data/jsonld/business-unit/"+n+"/product-imported":"/data/jsonld/business-unit/"+n+"/product")+"?sku="+encodeURIComponent(r)+"&numberOfReviews="+(a||10)+"&productName="+o+"&language="+c+"&templateId="+s+"&url="+encodeURIComponent(window.location.origin+window.location.pathname),h=u&&d&&l?{"@type":"Offer",priceCurrency:d,price:u,availability:l}:null,E.xhrGet({url:f,success:function(e){h&&(e.offers=h),(e.offers||e.review||e.aggregateRating)&&T(e)},error:function(e){console.error(e)}}),0)));var t,n,i,s,o,r,a,u,d,l,c,f,h,p,m,g,y,v,w,b,I}},{"./xhr.js":8}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),o=e("./constants"),r=i(e("./snippets")),a=e("./ab-settings"),u=i(e("./widget"));function i(e){return e&&e.__esModule?e:{default:e}}var d=function(){function i(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.window=e,this.document=t,this.widgets=[],this.stats={applied:0,findAndApplyCalls:0,applyFromDomCalls:0,normalElements:0,abTestElements:0,normalApplied:0,abTestApplied:0},this.version=n}return s(i,[{key:"initialize",value:function(){var n=this;this.hasABTestElements()?(0,a.getABSettingsAsync)(this.businessUnitId,function(e,t){n.abSettings=e,n.sessionExpiry=t,n.findAndApplyWidgets()}):this.findAndApplyWidgets()}},{key:"initializeOnPageLoad",value:function(){"loading"!==this.document.readyState?this.initialize():this.document.addEventListener("DOMContentLoaded",this.initialize.bind(this))}},{key:"applyWidgetFromDomElement",value:function(e,t){var n=e.firstChild&&"IFRAME"===e.firstChild.tagName;n&&!t||this.createWidget(e,!n)}},{key:"findAndApplyWidgets",value:function(){var t=this;this.stats.findAndApplyCalls+=1;var e=this.widgetElements;e&&0!==e.length&&(this.stats.normalElements=e.filter(function(e){return!("group"in e.dataset)}).length,this.stats.abTestElements=e.filter(function(e){return"group"in e.dataset}).length,e.forEach(function(e){return t.createWidget(e)}))}},{key:"hasABTestElements",value:function(){return[].slice.call(this.widgetElements).some(function(e){return"group"in e.dataset})}},{key:"createWidget",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(this.removeWidget(e),this.checkWidgetDisplayAndUpdateDataset(e)){var n=e.dataset;t&&(0,r.default)(n);var i="group"in n&&this.abSettings,s=i?{container:e,dataset:n,session:this.abSettings.session,anonymousId:this.abSettings.anonymousId,testId:this.abSettings.testId,sessionExpiry:this.sessionExpiry}:{container:e,dataset:n},o=new u.default(s);return o.initialize(),this.stats.applied+=1,this.stats[i?"abTestApplied":"normalApplied"]+=1,this.stats.applyFromDomCalls+=1,this.widgets.push(o),o}return null}},{key:"checkWidgetDisplayAndUpdateDataset",value:function(e){var t=e.dataset;return!(this.abSettings&&"group"in t)||(this.abSettings.group===t.group||this.abSettings.group===o.OFF&&(t.templateId=o.EMPTY_WIDGET_ID,t.styleHeight="0",t.group=o.OFF,!0))}},{key:"removeWidget",value:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}},{key:"closePopups",value:function(){this.widgets.forEach(function(e){return e.closePopup()})}},{key:"businessUnitId",get:function(){return this.widgetElements[0].dataset.businessunitId}},{key:"widgetElements",get:function(){return[].slice.call(this.document.getElementsByClassName("trustpilot-widget"))}}]),i}();n.default=d},{"./ab-settings":1,"./constants":2,"./snippets":3,"./widget":6}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var i="https:"===document.location.protocol?"https:":"http:",r=i+"//widget.trustpilot.com",a=i+"//widget.trustpilot.com/trustboxes";function u(e){var t="";return(e=e.toLowerCase())&&0<e.length&&(t=/(px|\%)/i.test(e)?e:e+"px"),t}var d=function(){function i(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.name=e,this.dataset=t,this.iframeData=n||this.defaultIframeOptions}return o(i,[{key:"getIframeOptionsFromData",value:function(){var e=this.iframeData||{styles:{}};return s({},this.defaultIframeOptions,{position:e.styles.position||"",zindex:e.styles.zindex||"",margin:e.styles.margin||"",top:e.styles.top||"",bottom:e.styles.bottom||"",left:e.styles.left||"",right:e.styles.right||"",height:e.styles.height||"",width:e.styles.width||this.defaultIframeOptions.styles.width||"",display:e.show?"block":"none",src:this.baseUrl+e.source+this.queryString,borderStyle:this.defaultIframeOptions.styles.borderStyle,overflow:this.defaultIframeOptions.styles.overflow})}},{key:"initialize",value:function(e,t){var n,i;this._iframe=(n=this.getIframeOptionsFromData(),(i=document.createElement("iframe")).style.position=n.position,i.style.zIndex=n.zindex,i.style.margin=n.margin,i.style.top=n.top,i.style.bottom=n.bottom,i.style.left=n.left,i.style.right=n.right,i.style.height=n.height,i.style.width=n.width,i.style.borderStyle=n.borderStyle,i.style.backgroundColor=n.backgroundColor,i.style.display=n.display,i.style.overflow=n.overflow,i.frameBorder=n.frameBorder,i.scrolling=n.scrolling,i.allowTransparency=n.allowTransparency,i.title="Customer reviews powered by Trustpilot",i.src=n.src,i),e.appendChild(this._iframe),this._iframe.addEventListener("load",t)}},{key:"sendMessage",value:function(e){this._iframe.contentWindow&&(e=JSON.stringify(e),this._iframe.contentWindow.postMessage(e,r))}},{key:"isInViewport",value:function(e){var t=this._iframe.getBoundingClientRect(),n=t.width||this._iframe.offsetWidth,i=t.height||this._iframe.offsetHeight;return 0<=t.top&&0<=t.left&&t.bottom-i*e<=(window.innerHeight||document.documentElement.clientHeight)&&t.right-n*e<=(window.innerWidth||document.documentElement.clientWidth)}},{key:"setWidgetId",value:function(e){this.sendMessage({command:"setId",widgetId:e})}},{key:"setStyle",value:function(n){var i=this;Object.keys(n).forEach(function(e){var t=n[e];i._iframe.style[e]=t})}},{key:"hide",value:function(){this.setStyle({display:"none"})}},{key:"resizeHeight",value:function(e){"number"==typeof e&&0!==e&&(this._iframe.style.height=e+"px")}},{key:"dimensions",get:function(){return{height:u(this.dataset.styleHeight),width:u(this.dataset.styleWidth)}}},{key:"queryString",get:function(){var t=this,n=function(e){return e+"="+encodeURIComponent(t.dataset[e])},e=function(e){return Object.keys(t.dataset).filter(e).map(n)},i=["businessunitId","templateId"],s=e(function(e){return-1!==i.indexOf(e)}),o=e(function(e){return-1===i.indexOf(e)});return"?"+s.join("&")+"#"+o.join("&")}},{key:"templateId",get:function(){return this.dataset.templateId}},{key:"baseUrl",get:function(){return a+"/"+this.templateId+"/"}},{key:"defaultIframeOptions",get:function(){return{source:"index.html",frameBorder:0,allowTransparency:"true",scrolling:"no",styles:{borderStyle:"none",backgroundColor:"transparent",display:"block",overflow:"hidden",height:this.dimensions.height,width:this.dimensions.width,position:"relative"},show:!0}}}]),i}();n.default=d},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),l=o(e("./tracking")),s=o(e("./iframe"));function o(e){return e&&e.__esModule?e:{default:e}}var r=function(){function d(e){var t=this,n=e.container,i=e.dataset,s=e.session,o=e.anonymousId,r=e.testId,a=e.sessionExpiry;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d);var u={container:n,dataset:i,templateId:i.templateId,businessUnitId:i.businessunitId,locale:i.locale};Object.keys(u).forEach(function(e){u[e]||function(e){throw"No "+e+" supplied for TrustBox"}(e)}),this.container=n,this.container.style.position="relative",this.dataset=i,this.iframes={},this.tracking=new l.default(function(e){return t.iframes.main.sendMessage(e)},function(){return t.isInViewport(.5)},{session:s,group:i.group,sessionExpiry:a,anonymousId:o,testId:r,templateId:i.templateId}),this.stats={createIFrameCalls:0,iframeLoadEvents:0,events:{}}}return i(d,null,[{key:"generateId",value:function(){for(var e=this.usedIds,t=void 0;t=Math.random(),-1!==e.indexOf(t););return this.usedIds.push(t)}}]),i(d,[{key:"initialize",value:function(){var e="https:"===document.location.protocol?"https:":"http:";this._widgetIFrameOrigin=e+"//widget.trustpilot.com",this.createIFrame("main"),this.attachMessageListener()}},{key:"handleCommand",value:function(e){var t=e.data,n=e.origin;try{var i="string"==typeof t?JSON.parse(t):t;return!!(-1!==["activate-old-brand","activate-new-brand"].indexOf(i.command)||n===this._widgetIFrameOrigin&&i.widgetId===this.id)&&this.widgetIframeMessageHandler(i)}catch(e){return!1}}},{key:"attachMessageListener",value:function(){window.addEventListener("message",this.handleCommand.bind(this),!1)}},{key:"widgetIframeMessageHandler",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};this.stats.events[e.command]=(this.stats.events[e.command]||0)+1;var i=e.name,s=e.style,o=e.height,r=this.iframes[i],a={createIFrame:function(){return t.createIFrame(i,e)},setStyle:function(){return r.setStyle(s)},loaded:function(){return t.iframes.main.sendMessage("loaded")},message:function(){return r.sendMessage(e)},"resize-height":function(){return t.getIframeOrMain(i).resizeHeight(o)},impression:function(){return t.tracking.initialize()},"activate-old-brand":function(){return t.switchBrand("old")},"activate-new-brand":function(){return t.switchBrand("new")}}[e.command];return a?(a(),!0):(n(),!1)}},{key:"switchBrand",value:function(e){var t=this,n="new"===e?"activate-new-brand":"activate-old-brand";Object.keys(this.iframes).forEach(function(e){t.iframes[e].sendMessage({command:n})})}},{key:"createIFrame",value:function(e,t){var n=this,i=new s.default(e,this.dataset,t);this.iframes[e]=i,this.stats.createIFrameCalls+=1,i.initialize(this.container,function(){i.setWidgetId(n.id),n.stats.iframeLoadEvents+=1})}},{key:"getIframeOrMain",value:function(e){return this.iframes[e]||this.iframes.main}},{key:"isInViewport",value:function(e){return this.iframes.main.isInViewport(e)}},{key:"closePopup",value:function(){if("popup"in this.iframes){this.iframes.main.sendMessage({name:"main",command:"message",message:"popup toggled",visible:!1}),this.iframes.popup.hide()}}},{key:"id",get:function(){return this._id||(this._id=this.constructor.generateId()),this._id}}]),d}();r.usedIds=[],n.default=r},{"./iframe":5,"./tracking":7}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),l=e("../constants");var s=function(){function d(e,t,n){var i=n.session,s=n.sessionExpiry,o=n.group,r=n.anonymousId,a=n.testId,u=n.templateId;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),this.hasSentImpression=!1,this.hasSentViewTracking=!1,this.sendMessage=e,this.isTrustBoxVisible=t,this.session=i,this.group=o,this.sessionExpiry=s,this.anonymousId=r,this.testId=a,this.templateId=u}return i(d,[{key:"initialize",value:function(){this.sendImpressionData(),this.attachListener(),this.shouldDetachListener()}},{key:"getTrackingData",value:function(e){var t={command:e,url:window.document.URL,referrer:window.document.referrer,userAgent:window.navigator.userAgent,language:window.navigator.userLanguage||window.navigator.language,platform:window.navigator.platform};return this.session&&this.group&&(t.session=this.session,t.sessionExpiry=this.sessionExpiry),this.anonymousId&&(t.anonymousId=this.anonymousId),this.testId&&(t.testId=this.testId),t}},{key:"sendImpressionData",value:function(){if(!this.hasSentImpression){this.hasSentImpression=!0;var e=this.getTrackingData("impression-received");this.sendMessage(e)}}},{key:"sendVisibilityData",value:function(){if(!this.hasSentViewTracking){this.hasSentViewTracking=!0;var e=this.getTrackingData("trustbox-in-viewport");this.sendMessage(e)}}},{key:"attachListener",value:function(){var t,n,i,s=arguments,e=this,o=(t=function(){(e.templateId===l.EMPTY_WIDGET_ID||e.shouldDetachListener())&&(window.removeEventListener("scroll",a,r),window.removeEventListener("resize",u,r))},n=100,i=void 0,function(){var e=s;clearTimeout(i),i=setTimeout(function(){i=null,t(e)},n)}),r={passive:!0,capture:!1},a=window.addEventListener("scroll",o,r),u=window.addEventListener("resize",o,r);o()}},{key:"shouldDetachListener",value:function(){return!!this.hasSentViewTracking||(this.hasBeenVisible?(this.hasSentImpression&&this.sendVisibilityData(),!0):!!this.isTrustBoxVisible()&&(this.hasSentImpression?(this.sendVisibilityData(),!0):this.hasBeenVisible=!0))}}]),d}();n.default=s},{"../constants":2}],8:[function(e,t,n){"use strict";function i(t){try{return JSON.parse(t.responseText)}catch(e){return t.responseText}}t.exports={xhrGet:function(e){var t=new window.XMLHttpRequest;t.open("GET",e.url,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4===t.readyState&&(200<=t.status&&t.status<300?e.success(i(t)):e.error&&e.error(i(t)))},t.send()}}},{}],9:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n){try{e=t("./lib/widget-management.js").default,window.Trustpilot=window.Trustpilot||{loadFromElement:function(e,t){return this.Modules.WidgetManagement&&this.Modules.WidgetManagement.applyWidgetFromDomElement(e,t)}},window.Trustpilot.Modules=window.Trustpilot.Modules||{},window.Trustpilot.Modules.WidgetManagement?window.Trustpilot.Modules.WidgetManagement.version!==n&&console.log("Detected legacy TrustBox bootstrap with version:",window.Trustpilot.Modules.WidgetManagement.version,", current:",n):(window.Trustpilot.Modules.WidgetManagement=new e(window,document,n),window.Trustpilot.Modules.WidgetManagement.initializeOnPageLoad()),window.addEventListener("click",function(){window.Trustpilot.Modules.WidgetManagement.closePopups()})}catch(t){!function(){function e(e){console.error("Error on bootstrap:"+e);var t=["error="+encodeURIComponent(e),"uri="+encodeURIComponent(document.URL),"bootstrapVersion="+n].join("&");document.createElement("img").src="//widget.trustpilot.com/feedback/report-error?"+t}try{"object"===(void 0===t?"undefined":i(t))?e(t.message):e(t)}catch(e){console.error("Error on error reporting method:"+e)}}()}var e}("1.264.0")},{"./lib/widget-management.js":4}]},{},[9]);
//# sourceMappingURL=tp.widget.bootstrap.min.js.map
